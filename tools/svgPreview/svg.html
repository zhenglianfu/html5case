<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>SVG Preview Tool</title>
    <link rel="stylesheet" type="text/css" href="../../stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="../../stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/svg-editor.css">
    <style>
        .hide{
            display: none;
        }
        .center{
            margin: 0 auto;
        }
        .bg-gray{
            background: #c0c0c0;
        }
        .padding{
            padding: 10px;
        }
        .relative{
            position: relative;
        }
        svg{
            background: #fff;
        }
        svg text{
            font-size: 16px;
        }
        .control-point{
            fill: #999;
            cursor: pointer;
        }
        .hp-line{
            fill: transparent;
            stroke: #999;
            stroke-width: 1px;
            pointer-events: none;
        }
        .bezier-path{
            fill: transparent;
            stroke-width: 3px;
            stroke: #333;
            pointer-events: none;
        }
        /*path{*/
            /*stroke-dasharray: 1000;*/
            /*stroke-dashoffset: 1000;*/
            /*animation: dash 3s linear infinite;*/
            /*-webkit-animation: dash 3s linear infinite;*/
        /*}*/
        @keyframes dash {
            from{
                stroke-dasharray: 1000;
                stroke-dashoffset: 1000;
            }
            to {
                stroke-dashoffset: 0;
            }
        }
        @-webkit-keyframes dash {
            from{
                stroke-dasharray: 1000;
                stroke-dashoffset: 1000;
            }
            to {
                stroke-dashoffset: 0;
            }
        }
        .svg-editor-wrap{
            padding: 10px;
            text-align: center;
        }
        .svg-editor-wrap p{
            font-size: 14px;
            margin-bottom: 10px;
        }
        .svg-editor{
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="bg-gray padding">
        <div class="center" style="width: 500px;">
            <svg width="500" height="300" id="twice_bezier" viewBox="0 0 500 300">
                <circle cx="50" cy="200" r="5" id="m" class="control-point"></circle>
                <circle cx="200" cy="50" r="5" id="c" class="control-point"></circle>
                <circle cx="450" cy="200" r="5" id="r" class="control-point"></circle>
                <polyline points="50,200 200,50 450,200" class="hp-line"></polyline>
                <path d="M50,200Q200,50 450,200" class="bezier-path"></path>
                <text x="200" y ="25">二次曲线演示</text>
                <text id="twice_bezier_path" x="140" y="280">path(50,200 200,50 450,200)</text>
            </svg>
        </div>
        <div class="center" style="width: 500px;">
            <svg width="500" height="300" id="cube_bezier">
                <circle cx="50" cy="200" r="5" id="cube_m" class="control-point"></circle>
                <circle cx="200" cy="100" r="5" id="cube_c1" class="control-point"></circle>
                <circle cx="300" cy="100" r="5" id="cube_c2" class="control-point"></circle>
                <circle cx="450" cy="200" r="5" id="cube_end" class="control-point"></circle>
                <polyline points="50,200 200,100 300,100 450,200" class="hp-line"></polyline>
                <path d="M50,200C200,100 300,100 450,200" class="bezier-path"></path>
                <text x="200" y="25">三次曲线演示</text>
                <text id="cube_bezier_path" x="120" y="280">path(50,200 200,100 300,100 450,200)</text>
            </svg>
        </div>
    </div>
    <div class="svg-editor-wrap">
        <div>
            <div class="editor-panel">
                <div class="svg-editor">
                    <div class="menu-bar">
                        <ul class="menu-list clear-fix">
                            <li class="menu-item" id="add">新建</li>
                            <li class="menu-item" id="clear">清空</li>
                            <li class="menu-item" id="toggleGridGuides">开启坐标线</li>
                            <li class="menu-item" id="toggleDrawGuides">开启辅助线</li>
                            <li class="menu-item" id="code">XML代码</li>
                            <li class="menu-item" id="fullScreen">全屏</li>
                            <!-- 画布信息 -->
                            <li class="menu-item info-item" id="svgInfo">
                                <label>x: <input type="tel" id="svg_x"></label>
                                <label>y: <input type="tel" id="svg_y"></label>
                                <label>w: <input type="tel" id="svg_w"></label>
                                <label>h: <input type="tel" id="svg_h"></label>
                            </li>
                            <li class="menu-item disabled" id="revert">撤销</li>
                            <li class="menu-item disabled" id="redo">重做</li>
                        </ul>
                    </div>
                    <div class="tool-bar">
                        <div class="box-title">工具箱</div>
                        <div class="tool-list-wrap">
                            <ul class="tool-list">
                                <li class="tool-item" id="mouse">
                                    <div class="tool-item-content" title="鼠标工具">
                                        <svg width="38px" height="37px">
                                            <!-- 鼠标工具 -->
                                            <g id="mouse_icon">
                                                <path d="M10,25L10,10L25,10L10,25m5,-5l10,10l5,-5l-10,-10" class="default-stroke"></path>
                                            </g>

                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item even" id="resize">
                                    <div class="tool-item-content" title="调整画布尺寸">
                                        <svg width="38px" height="37px" xmlns="http://www.w3.org/2000/svg" xmlns:link="http://www.w3.org/1999/xlink">
                                            <!-- 更改画布尺寸 -->
                                            <g id="arrow" class="default-stroke">
                                                <title>resize arrow</title>
                                                <path d="M8,15L8,8L15,8M8,8L16,16"></path>
                                            </g>
                                            <use xlink:href="#arrow" x="0" y="0" style="transform: translate(37px,37px) scale(-1,-1);"></use>
                                            <use xlink:href="#arrow" x="0" y="0" style="transform: translate(0px,37px) scale(1,-1);"></use>
                                            <use xlink:href="#arrow" x="0" y="0" style="transform: translate(37px,0px) scale(-1,1);"></use>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="move">
                                    <div class="tool-item-content" title="移动">
                                        <svg width="38px" height="39px" xmlns="http://www.w3.org/2000/svg" xmlns:link="http://www.w3.org/1999/xlink">
                                            <!-- 移动 -->
                                            <g id="double_arrow" class="default-stroke">
                                                <path d="M16,14L20,10L24,14M20,10L20,30L16,26M20,30L24,26Z"></path>
                                                <path d="M8,20L12,24M8,20L12,16M8,20L31,20L27,16M31,20L27,24Z"></path>
                                            </g>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="clipPath">
                                    <div class="tool-item-content" title="裁剪">
                                        <svg width="38px" height="37px" xmlns="http://www.w3.org/2000/svg" xmlns:link="http://www.w3.org/1999/xlink">
                                            <rect x="10" y="10" height="20" width="20" class="default-stroke" style="stroke-dasharray: 2;"></rect>
                                            <line x1="25" y1="5" x2="35" y2="15" class="default-stroke"></line>
                                            <line x1="35" y1="5" x2="25" y2="15" class="default-stroke"></line>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="text">
                                    <div class="tool-item-content" title="文本">
                                        <svg width="38px" height="39px" xmlns="http://www.w3.org/2000/svg">
                                            <text x="5" y="25" class="default-stroke">TXT</text>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="line">
                                    <div class="tool-item-content" title="直线">
                                        <svg width="38px" height="37px">
                                            <g>
                                                <line x1="8" y1="8" x2="29" y2="29" class="default-stroke" />
                                            </g>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="arrowLine">
                                    <div class="tool-item-content" title="带箭头的">
                                        <svg width="38px" height="37px">
                                            <defs>
                                                <marker id="mArrow" markerWidth="4" markerHeight="8" orient="auto" refX="4" refY="4">
                                                    <path d="M0,0 4,4 0,8" style="fill: none; stroke: #333;"></path>
                                                </marker>
                                            </defs>
                                            <line x1="6" y1="28" x2="28" y2="6" d="M6 28L28 6" class="default-stroke" style="marker-end: url(#mArrow)"></line>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item even" id="polyline">
                                    <div class="tool-item-content" title="折线">
                                        <svg width="38px" height="39px" xmlns="http://www.w3.org/2000/svg" xmlns:link="http://www.w3.org/1999/xlink">
                                            <polyline class="default-stroke" points="10,10 30,10 10,30 30,30"></polyline>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="polygon">
                                    <div class="tool-item-content" title="多边形">
                                        <svg width="38px" height="37px" xmlns="http://www.w3.org/2000/svg" xmlns:link="http://www.w3.org/1999/xlink">
                                            <polygon class="default-stroke" points="10,20 15,10 25,10 30,20 25,30 15,30 10,20"></polygon>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item even" id="rect">
                                    <div class="tool-item-content">
                                        <svg width="38px" height="37px">
                                            <g>
                                                <rect height="15" width="15" x="10" y="10" class="default-stroke"></rect>
                                            </g>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="ellipse">
                                    <div class="tool-item-content">
                                        <svg height="38px" width="37px">
                                            <g>
                                                <ellipse cx="20" cy="20" rx="12" ry="7" class="default-stroke"></ellipse>
                                            </g>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item" id="circle">
                                    <div class="tool-item-content">
                                        <svg width="38px" height="37px">
                                            <g>
                                                <circle r="10" cx="19" cy="18" class="default-stroke"></circle>
                                            </g>
                                        </svg>
                                    </div>
                                </li>
                                <li class="tool-item even" id="pen">
                                    <div class="tool-item-content">
                                        <svg width="38px" height="37px">
                                            <path d="M24,6L6,24M30,12L12,30M27,9L9,27M24,6L30,12M6,24L12,30L6,32L6,24" class="default-stroke"></path>
                                        </svg>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="svg-background">
                            <div>颜色</div>
                            <div class="text-left">
                                <div>填充：<span class="color transparent" id="fillColor"></span></div>
                                <div>描边：<span class="color" id="strokeColor"></span></div>
                            </div>

                        </div>
                        <!-- 鼠标位置 -->
                        <div class="mouse-info">
                            <div>鼠标相对位置</div>
                            <div>
                                <div>
                                    X: <span id="mouse_x" class="value">0</span>
                                </div>
                                <div>
                                    Y: <span id="mouse_y" class="value">0</span>
                                </div>
                            </div>
                        </div>
                        <!--<div class="more-tool-icon"></div>-->
                    </div>
                    <div class="panel-wrap">
                        <div class="relative h100" id="panelContainers">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="copyright">
            <a href="https://github.com/zhenglianfu">&copy;zhenglianfu@github</a>
        </div>
    </footer>
    <script type="text/javascript" src="/javascript/keymap.js"></script>
    <input type="color" class="hide" id="colorPicker">
    <script type="text/javascript" src="../../javascript/jquery.js"></script>
    <script type="text/javascript" src="../../javascript/jquery.md5.js"
    <script>
        var maxHeight = 100;
        var width = 150;
        var y = 0;
        var waveNum = 10;
        var $path = $('path').eq(0);
        function wave(k){
            var maxK = maxHeight / 2;
//            k = Math.abs(k) > maxK ? maxK : k;
            var unitWidth = width / 3;
            var d = '';
            for (var i = 0; i < waveNum; i ++) {
                var m = [i * width, maxHeight/2];
                d += 'M' + m.join(' ');
                var c = [i * width + unitWidth, maxK - k, i * width + unitWidth * 2, maxK + k, i * width + unitWidth * 3, maxK];
                d += 'C' + c.join(' ');
            }
            $path.attr('d', d);
            return d;
        }
        var k = 30;
        var step = 3;
        function shake(g){
            if (k <= 0) {
                wave(0);
                return;
            }
            wave(g);
            if (Math.abs(g) >= k) {
                step = -step;
                k --;
                g = g > 0 ? k : -k;
            }
            setTimeout(function(){
                g += step;
                console.log(g, k);
                shake(g);
            }, 16.7);
        }
//        shake(0);
    </script>
    <script>
        /* 曲线 */
        $(function(){
            var $svg = $('#twice_bezier');
            function pointEvent(point, fn){
                var isDrag = false;
                point.on('mousedown', function(){
                    isDrag = true;
                });
                point.parent().on('click', function(){
                   isDrag = false;
                }).bind('mousemove', function(e){
                    if (isDrag) {
                        var x = e.offsetX,
                                y = e.offsetY;
                        point.attr({
                            cx : x,
                            cy : y
                        });
                        fn && fn(point);

                    }
                });
            }
            function reDrawPolyLine(){
                var points = '';
                $svg.find('circle').each(function(){
                    points += $(this).attr('cx') +','+  $(this).attr('cy') + ' ';
                });
                $svg.find('.hp-line').attr('points', points);
            }
            function reDrawBezierPath(){
                var path = '',
                    points = [];
                $svg.find('circle').each(function(index){
                    path += (index == 0 ? 'M' : '') + (index == 1 ? 'Q' : '') + $(this).attr('cx') + ' ' + $(this).attr('cy') + ' ';
                    points[index] = $(this).attr('cx') + ',' + $(this).attr('cy');
                });
                $svg.find('.bezier-path').attr('d', path);
                $('#twice_bezier_path').text('path(' + points.join(' ') + ')');
            }
            $svg.find('.control-point').each(function(){
                pointEvent($(this), function(){
                    reDrawPolyLine();
                    reDrawBezierPath();
                });
            });
            // cube bezier
            var $cubeSvg = $('#cube_bezier');
            function reDrawCubePolyLine(){
                var points = [];
                $cubeSvg.find('circle').each(function(){
                    points.push($(this).attr('cx') +','+  $(this).attr('cy'));
                });
                $cubeSvg.find('.hp-line').attr('points', points.join(' '));
            }
            function reDrawCubeBezierPath(){
                var path = '',
                    points = [];
                $cubeSvg.find('circle').each(function(index){
                    var x = $(this).attr('cx'),
                        y = $(this).attr('cy');
                    path += (index == 0 ? 'M' : '') + (index == 1 ? 'C' : '') + x + ' ' + y + ' ';
                    points[index] = x + ',' + y;
                });
                $cubeSvg.find('.bezier-path').attr('d', path);
                $('#cube_bezier_path').text('path(' + points.join(' ') + ')');
            }
            $cubeSvg.find('.control-point').each(function(){
                pointEvent($(this), function(){
                    reDrawCubePolyLine();
                    reDrawCubeBezierPath();
                });
            });
        });
    </script>
    <script type="text/javascript" src="js/svg-editor.js"></script>
</body>
</html>